import{w as I,r,u as y,j as s}from"./chunk-PVWAREVJ-DHjQzAty.js";import{E as M,F as P,a as U,g as v}from"./modal-BhtBJdvC.js";import{l as A}from"./firebase-yRvBWTGt.js";import{B as D}from"./button-Bj7XQSOb.js";import{u as O}from"./AuthContext-Cy9VIbgu.js";import{u as T}from"./useTranslation-ZsYxALZe.js";import{F as B}from"./index.esm-DEVYYNpo.js";import"./i18next-Bhq85MQn.js";import"./x-D9UkY--3.js";import"./index-BzYe63nO.js";import"./index-Cd_xhWcG.js";const X=I(function(){const{t:c}=T(),[o,b]=r.useState({username:"",email:"",password:""}),[u,m]=r.useState({}),[,j]=r.useState(!1),{user:p,token:h,setUser:k,setToken:E}=O(),f=y(),[N,w]=r.useState(!1),[S,C]=r.useState(""),d=l=>{C(l),w(!0)};r.useEffect(()=>{p&&f("/mainClint")},[p,f]);const g=l=>{const{name:t,value:i}=l.target;b(n=>({...n,[t]:i}));const a=v().safeParse({...o,[t]:i});if(a.success)m(n=>({...n,[t]:void 0}));else{const n=a.error.issues.find(x=>x.path[0]===t);m(x=>({...x,[t]:n?n.message:void 0}))}},F=async l=>{l.preventDefault(),j(!0);const i=v().safeParse(o);if(i.success){m({});try{const e=await A(o.email,o.password);e&&(console.log("is logined:",e.user),console.log("token:",e.token),k(e.user),E(e.token),document.cookie=`userToken=${e.token}; path=/; max-age=3600; samesite=lax;`,document.cookie=`userId=${e.user.uid}; path=/; max-age=3600; samesite=lax;`,f("/mainClint"))}catch(e){e instanceof B?(d(e.message),console.error("Firebase error:",e)):e instanceof Error?(e.message.includes("setUser must be used within AuthProvider")?console.warn("Internal React hook error, ignoring for modal:",e):d(e.message),console.error("JS error:",e)):(d("Unknown error"),console.error("Unknown error:",e))}}else{const e={};i.error.issues.forEach(a=>{a.path[0]&&(e[a.path[0]]=a.message)}),m(e)}};return r.useEffect(()=>{console.log("user from context:",p),console.log("token from context:",h)},[p,h]),s.jsxs("form",{onSubmit:F,className:"form-position  text-purple-600  flex flex-col items-center",children:[s.jsx(M,{isOpen:N,onClose:()=>w(!1),message:S}),s.jsx("h2",{className:"pb-[3vw] font-inter text-xl text-purple-600",children:c("auth.signIn")}),s.jsxs("div",{className:"flex flex-col items-center p-[5vw] gap-[1vw] rounded-[15%] border-2 border-purple-300",children:[s.jsx("p",{className:"errors text-center w-full",children:u.username||""}),s.jsxs("div",{className:"relative w-full max-w-[40vw]",children:[s.jsx(P,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-purple-400"}),s.jsx("input",{name:"email",placeholder:c("form.email"),value:o.email,onChange:g,className:"pl-10 pr-2 text-center bg-transparent w-full border-b border-purple-400 text-purple-500 placeholder-purple-300 focus:outline-none focus:border-purple-600 font-inter text-xl overflow-x-auto whitespace-nowrap"})]}),s.jsx("p",{className:"errors text-center w-full",children:u.email||""}),s.jsxs("div",{className:"relative w-full max-w-[40vw]",children:[s.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-purple-400"}),s.jsx("input",{name:"password",type:"password",placeholder:c("form.password"),value:o.password,onChange:g,className:"pl-10 pr-2 text-center bg-transparent w-full border-b border-purple-400 text-purple-500 placeholder-purple-300 focus:outline-none focus:border-purple-600 font-inter text-xl overflow-x-auto whitespace-nowrap"})]}),s.jsx("p",{className:"errors text-center w-full",children:u.password||""}),s.jsx("div",{className:"buttons-block pt-[3vw]",children:s.jsx(D,{variant:"custom",type:"submit",children:c("form.submit")})})]})]})});export{X as default};
